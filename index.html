<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유연한 업무 계획표</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        /* 시간 입력 필드의 시계 아이콘 숨기기 */
        input[type="time"]::-webkit-calendar-picker-indicator {
            background: none;
            display: none;
        }
        /* 숫자 입력 필드 화살표 숨기기 */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        /* 텍스트 영역 스크롤 숨김 및 크기 조절 */
        textarea {
            field-sizing: content; /* 최신 브라우저 지원 */
            min-height: 2.5rem;
            resize: none;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden border border-gray-200">
        <!-- 상단 정보 영역 -->
        <div class="p-6 bg-white border-b border-gray-200 grid grid-cols-1 md:grid-cols-12 gap-6 items-start relative">
            <div class="md:col-span-3">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Date</label>
                <input type="date" id="dateInput" class="w-full border-b-2 border-gray-200 focus:border-gray-800 outline-none py-2 text-gray-700 font-medium transition-colors bg-transparent">
            </div>
            <div class="md:col-span-6">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-1">Main Goal</label>
                <input type="text" placeholder="오늘의 핵심 목표를 입력하세요" class="w-full border-b-2 border-gray-200 focus:border-gray-800 outline-none py-2 text-gray-700 font-medium transition-colors bg-transparent">
            </div>
            
            <!-- 단축키 도움말 -->
            <div class="md:col-span-3 bg-gray-50 rounded p-3 text-xs text-gray-500 border border-gray-200">
                <h4 class="font-bold text-gray-700 mb-1"><i class="fas fa-keyboard mr-1"></i>단축키 가이드</h4>
                <ul class="space-y-1">
                    <li><span class="font-mono bg-white px-1 border rounded">Enter</span> : 줄바꿈 (입력창)</li>
                    <li><span class="font-mono bg-white px-1 border rounded">Ctrl</span> + <span class="font-mono bg-white px-1 border rounded">Enter</span> : 행 추가</li>
                    <li><span class="font-mono bg-white px-1 border rounded">Ctrl</span> + <span class="font-mono bg-white px-1 border rounded">Del</span> : 행 삭제</li>
                    <li><span class="font-mono bg-white px-1 border rounded">Alt</span> + <span class="font-mono bg-white px-1 border rounded">방향키</span> : 셀 이동</li>
                </ul>
            </div>
        </div>

        <!-- 테이블 영역 -->
        <div class="overflow-x-auto">
            <table class="w-full min-w-[800px] border-collapse" id="scheduleTable">
                <thead>
                    <tr class="bg-gray-800 text-white text-sm uppercase tracking-wider text-center">
                        <th class="p-4 w-24 font-medium border-r border-gray-700">단위</th>
                        <th class="p-4 w-48 font-medium border-r border-gray-700">시간</th>
                        <th class="p-4 w-1/3 font-medium border-r border-gray-700">업무</th>
                        <th class="p-4 w-1/3 font-medium">메모</th>
                        <th class="p-4 w-20 font-medium bg-gray-900"></th>
                    </tr>
                </thead>
                <tbody id="tableBody" class="text-gray-700">
                    <!-- 자바스크립트로 행이 추가됩니다 -->
                </tbody>
            </table>
        </div>
        
        <!-- 하단 컨트롤 -->
        <div class="p-4 bg-gray-50 border-t border-gray-200 flex justify-between items-center">
            <div class="text-sm text-gray-500">
                <i class="fas fa-info-circle mr-1"></i> 단위 1 = 1시간, 0.5 = 30분입니다.
            </div>
            <button onclick="window.print()" class="px-4 py-2 bg-gray-800 text-white rounded hover:bg-gray-700 transition-colors text-sm font-medium">
                <i class="fas fa-print mr-2"></i>인쇄하기
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('dateInput').valueAsDate = new Date();
            // 초기 행 추가
            addRow(null, '0.5', '09:00');
            
            // 키보드 이벤트 리스너 등록
            document.getElementById('tableBody').addEventListener('keydown', handleKeydown);
        });

        // 분을 시간 문자열로 변환
        function addHoursToTime(timeStr, hours) {
            if (!timeStr) return '';
            const [h, m] = timeStr.split(':').map(Number);
            const totalMinutes = h * 60 + m + (parseFloat(hours) * 60);
            
            let newH = Math.floor(totalMinutes / 60);
            let newM = Math.floor(totalMinutes % 60);
            
            if (newH >= 24) newH = newH % 24;

            return `${String(newH).padStart(2, '0')}:${String(newM).padStart(2, '0')}`;
        }

        // 행 업데이트
        function updateRow(input) {
            const row = input.closest('tr');
            const unitInput = row.querySelector('.unit-input');
            const timeInput = row.querySelector('.time-start');
            const endTimeSpan = row.querySelector('.time-end');

            const unitVal = parseFloat(unitInput.value) || 0;
            const startTimeVal = timeInput.value;

            if (startTimeVal && unitVal > 0) {
                const endTime = addHoursToTime(startTimeVal, unitVal);
                endTimeSpan.textContent = `- ${endTime}`;
                
                if (unitVal >= 1) {
                    row.classList.add('bg-indigo-50');
                    row.classList.remove('bg-white');
                } else {
                    row.classList.add('bg-white');
                    row.classList.remove('bg-indigo-50');
                }
            } else {
                endTimeSpan.textContent = '';
            }
        }

        // 행 추가
        function addRow(btn, initialUnit = '0.5', initialTime = null) {
            const tbody = document.getElementById('tableBody');
            
            let newUnit = initialUnit;
            let newTime = '09:00';
            let targetRow = null;

            // 버튼이나 단축키로 호출된 경우 기준 행 찾기
            if (btn) {
                // btn이 실제 버튼 요소이거나, 현재 포커스된 요소일 수 있음
                targetRow = btn.closest ? btn.closest('tr') : btn; 
                
                if (targetRow) {
                    const prevStart = targetRow.querySelector('.time-start').value;
                    const prevUnit = targetRow.querySelector('.unit-input').value;
                    newUnit = prevUnit; 
                    if (prevStart && prevUnit) {
                        newTime = addHoursToTime(prevStart, prevUnit);
                    }
                }
            } else if (initialTime) {
                newTime = initialTime;
            }

            const tr = document.createElement('tr');
            tr.className = 'border-b border-gray-200 hover:bg-gray-50 transition-colors group bg-white';
            
            tr.innerHTML = `
                <td class="p-2 border-r border-gray-100 align-top">
                    <input type="number" step="0.5" min="0.1" class="unit-input w-full text-center py-2 text-gray-600 font-medium bg-transparent focus:bg-white focus:ring-2 focus:ring-indigo-200 rounded outline-none" 
                           value="${newUnit}" onchange="updateRow(this)" oninput="updateRow(this)">
                </td>
                <td class="p-2 border-r border-gray-100 text-center align-top">
                    <div class="flex items-center justify-center space-x-2 bg-gray-50 rounded py-1 px-2 border border-gray-100">
                        <input type="time" class="time-start bg-transparent text-gray-800 font-mono font-medium text-center focus:outline-none w-20 cursor-pointer" 
                               value="${newTime}" onchange="updateRow(this)">
                        <span class="time-end text-gray-500 font-mono text-sm w-16 text-left"></span>
                    </div>
                </td>
                <td class="p-2 border-r border-gray-100 align-top">
                    <textarea class="w-full px-3 py-2 text-gray-700 bg-transparent focus:bg-white rounded outline-none placeholder-gray-300 transition-all" 
                              placeholder="업무 내용" rows="1" oninput="autoResize(this)"></textarea>
                </td>
                <td class="p-2 align-top">
                    <textarea class="w-full px-3 py-2 text-gray-500 bg-transparent focus:bg-white rounded outline-none placeholder-gray-300 transition-all" 
                              placeholder="메모" rows="1" oninput="autoResize(this)"></textarea>
                </td>
                <td class="p-2 text-center align-top">
                    <div class="flex items-center justify-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity pt-1">
                        <button onclick="addRow(this)" class="w-7 h-7 rounded-full bg-blue-50 text-blue-600 hover:bg-blue-100 flex items-center justify-center" title="추가 (Ctrl+Enter)">
                            <i class="fas fa-plus text-xs"></i>
                        </button>
                        <button onclick="deleteRow(this)" class="w-7 h-7 rounded-full bg-red-50 text-red-500 hover:bg-red-100 flex items-center justify-center" title="삭제 (Ctrl+Del)">
                            <i class="fas fa-minus text-xs"></i>
                        </button>
                    </div>
                </td>
            `;

            if (targetRow) {
                targetRow.after(tr);
            } else {
                tbody.appendChild(tr);
            }
            
            updateRow(tr.querySelector('.unit-input'));
            
            // 새로 추가된 행의 첫 번째 텍스트 영역(업무)에 포커스
            if (targetRow || btn) {
                setTimeout(() => {
                    const firstTextarea = tr.querySelector('textarea');
                    if(firstTextarea) firstTextarea.focus();
                }, 50);
            }
        }

        // 행 삭제
        function deleteRow(btn) {
            // btn은 버튼 요소이거나 tr 요소일 수 있음 (단축키 호출 시 tr)
            const row = btn.tagName === 'TR' ? btn : btn.closest('tr');
            const tbody = document.getElementById('tableBody');
            
            if (tbody.children.length > 1) {
                // 삭제 전 포커스 이동 (위쪽 행으로)
                const prevRow = row.previousElementSibling;
                const nextRow = row.nextElementSibling;
                const targetToFocus = prevRow || nextRow;
                
                row.remove();
                
                if (targetToFocus) {
                    const input = targetToFocus.querySelector('textarea');
                    if (input) input.focus();
                }
            } else {
                // 마지막 행은 내용만 비우기
                row.querySelectorAll('textarea').forEach(input => {
                    input.value = '';
                    input.style.height = 'auto'; // 높이 초기화
                });
            }
        }

        // 텍스트영역 자동 높이 조절
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        // 키보드 단축키 핸들러
        function handleKeydown(e) {
            // 현재 포커스된 요소가 input이나 textarea가 아니면 무시
            if (!['INPUT', 'TEXTAREA'].includes(e.target.tagName)) return;

            const currentElement = e.target;
            const currentRow = currentElement.closest('tr');
            
            // 2. 행 추가 (Ctrl + Enter)
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                addRow(currentRow);
                return;
            }

            // 3. 행 삭제 (Ctrl + Delete)
            if (e.ctrlKey && (e.key === 'Delete' || e.key === 'Backspace')) {
                e.preventDefault();
                deleteRow(currentRow);
                return;
            }

            // 4. 셀 이동 (Alt + 방향키) - 방향키 충돌 방지를 위해 Alt 키 사용
            if (e.altKey && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                navigateCells(currentElement, e.key);
                return;
            }
        }

        function navigateCells(current, direction) {
            const currentRow = current.closest('tr');
            const cellIndex = Array.from(currentRow.children).indexOf(current.closest('td'));
            
            let targetRow, targetCell, targetInput;

            if (direction === 'ArrowUp') {
                targetRow = currentRow.previousElementSibling;
                if (targetRow) {
                    targetCell = targetRow.children[cellIndex];
                }
            } else if (direction === 'ArrowDown') {
                targetRow = currentRow.nextElementSibling;
                if (targetRow) {
                    targetCell = targetRow.children[cellIndex];
                }
            } else if (direction === 'ArrowLeft') {
                targetCell = current.closest('td').previousElementSibling;
                // 이전 셀이 없으면 위 행의 마지막 셀로? (선택사항, 여기선 같은 행 유지)
                targetRow = currentRow;
            } else if (direction === 'ArrowRight') {
                targetCell = current.closest('td').nextElementSibling;
                targetRow = currentRow;
            }

            if (targetCell || (targetRow && !targetCell)) {
                // 셀 내부의 input이나 textarea 찾기
                targetInput = targetCell ? targetCell.querySelector('input, textarea') : null;
                if (targetInput) {
                    targetInput.focus();
                }
            }
        }
    </script>
</body>
</html>
